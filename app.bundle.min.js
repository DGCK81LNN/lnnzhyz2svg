(()=>{var q=Object.defineProperty;var $e=Object.getOwnPropertyDescriptor;var ye=Object.getOwnPropertyNames;var Re=Object.prototype.hasOwnProperty;var u=(e,n)=>()=>(e&&(n=e(e=0)),n);var Q=(e,n)=>{for(var t in n)q(e,t,{get:n[t],enumerable:!0})},Te=(e,n,t,r)=>{if(n&&typeof n=="object"||typeof n=="function")for(let o of ye(n))!Re.call(e,o)&&o!==t&&q(e,o,{get:()=>n[o],enumerable:!(r=$e(n,o))||r.enumerable});return e};var Ce=e=>Te(q({},"__esModule",{value:!0}),e);function D(e,...n){return e.trim().split(/\s+/g).map(r=>r.split(/_|(?=-)/g).map(i=>{let s={};i[0]==="-"&&(s.hyphen=!0,i=i.slice(1)),i[0]==="^"&&(s.proper=!0,i=i.slice(1));let a;for(let c of n)if(a=c(i),a)break;if(!a)throw new SyntaxError(`invalid character ${i}`);return Object.assign(s,a)}))}var F=u(()=>{});function ke(e){return e=e.toLowerCase(),e==="er"||e==="rr"?{modifier:"rr"}:e==="w"?{consonant:""}:["i","u","y"].includes(e)?{glide:e}:["a","o","e"].includes(e)?{vowel:e}:{consonant:e}}function Pe(e){if(e==="hm"||e==="hng")return{main:{consonant:"h"},pre:[],post:[{consonant:e==="hm"?"m":""}]};let n=e.match(Oe)||e.match(Se)||e.match(ze);if(!n)return;let[,t,r,o,i,s]=n;if(!t&&!r&&!o&&!i)return;t==="ng"&&(t=""),i&&!o&&(o="e"),r==="iu"&&(r="y"),o==="o"&&(i==="u"?o="e":(t||r)&&(r=r==="i"?"y":"u",o="e"));let a={main:{consonant:t||""},pre:[],post:[]},c={...r?{glide:r}:null,...o?{vowel:o}:null,...i?{coda:i}:null,...s==="3"||s==="4"?{reversed:!0}:null};return(s==="2"||s==="3"?a.pre:a.post).push(c),a}function Ae(e){let n=e.match(De);if(!n)return;let[,t]=n;return{main:ke(t),pre:[],post:[]}}function k(e){return D(e,Pe,Ae)}var Se,Oe,ze,De,ee=u(()=>{F();Se=/^(zh|ch|sh|[bpmfdtnlgkhjqxrzcs])?([iuy]|iu)?([aeo])?([iunr]|ng)?([1-4])$/,Oe=/^(ng)()()()([1-4])$/,ze=/^()()(eh)()([1-4])$/,De=/^([A-Za-z]|[ZzCcSs]h|[EeRr]r|[0-9]|[Xx][a-f])$/});function f(e,n){return Object.prototype.hasOwnProperty.call(e,n)}function R(e,n,t){return f(e,n)?e[n]:t}function P(e,n,t){return n||t?e.replace(/([hv])(-?)(\d+(?:\.\d+)?)/g,(r,o,i,s)=>((o==="h"?n:t)&&(i=i?"":"-"),`${o}${i}${s}`)).replace(/m(-?)(\d+(?:\.\d+)?),(-?)(\d+(?:\.\d+)?)/g,(r,o,i,s,a)=>(n&&(o=o?"":"-"),t&&(s=s?"":"-"),`m${o}${i},${s}${a}`)):e}function A(e,n){let t=e.length;for(let r=0;r<t;r++)if(n(e[r],r,e))return r;return t}function K(e,n){for(let t=e.length-1;t>=0;t--)if(n(e[t],t,e))return t;return-1}function Y(e,n){for(let t in e)if(n(e[t],t))return t}function y(e,n,t){if(t in e)return t in n&&e[t]===n[t];if(t in n)return!1}function Le(e,n){return!(!!e.reversed!=!!n.reversed||y(e,n,"glide")===!1||y(e,n,"vowel")===!1||y(e,n,"coda")===!1)}function w(e,n){var t,r;return(r=(t=y(e,n,"consonant"))!=null?t:y(e,n,"modifier"))!=null?r:Le(e,n)}var T=u(()=>{});function Ne(e,n){return!e&&!n?[]:[{...R(L,n),...e?{glide:e}:null}]}function ne(e){return[...e].map(n=>R(L,n))}function M(e){return D(e,n=>{let t=n.match(Me)||n.match(je)||n.match(He);if(!t)throw new SyntaxError(`Invalid Shidinn character ${n}`);let[,r,o,i,s,a]=t;return{pre:ne(r),main:R(L,o),post:Ne(i,s).concat(ne(a))}})}var Me,je,He,Ie,L,te=u(()=>{T();F();Me=/^([1-8ABDEFHLNTVYa-z]*)([457BDFHNbcdfghj-np-tv-z])(i(?![1E])|u(?![1A])|)([12368AELTVYaeo])([1-8ABD-FHLNTVYa-z]*)$/,je=/^([1-8ABDEFHLNTVYa-z]*)([457BDFHNbcdfghj-np-tv-z])([iu])()([1-8ABD-FHLNTVYa-z]*)$/,He=/^()([1-8ABDEFHLNTVYa-z]|X[0-9a-f])()()()$/,Ie={w:"v",y:"yj",n:"nj",D:"c",r:"rz",H:"nz",N:"ng",l:"n",4:"",5:"ngw",v:"nw",F:"dw",7:"tw",B:"gw",c:"kw"},L={...Object.fromEntries([..."bpmwjqxynzDsrHNldtgkh45vF7Bcf"].map(e=>[e,{consonant:R(Ie,e,e)}])),u:{glide:"u"},a:{vowel:"a"},o:{vowel:"oo"},e:{vowel:"e"},E:{vowel:"ii"},A:{vowel:"uu"},Y:{vowel:"a",coda:"i"},L:{vowel:"a",coda:"u"},6:{vowel:"e",coda:"u"},2:{vowel:"a",coda:"n"},T:{vowel:"a",coda:"ng"},8:{vowel:"e",coda:"n"},3:{vowel:"e",coda:"ng"},V:{vowel:"e",coda:"i"},1:{},i:{glide:"i"}};for(let e=0;e<16;e++){let n=e.toString(16);L[`X${n}`]={consonant:e<10?`${e}`:`x${n}`}}});var re=u(()=>{ee();te()});var ie,oe=u(()=>{ie={consonants:{"":"v12m0,-12h6v12",b:"v4h6m-6,-4h6v12",p:"h6v4h-6m0,-4v12",m:"h6v12m-6,0v-12m0,4h6",f:"h6m-6,0v12m0,-8h6",d:"h6v12m0,-8h-6v4h6",t:"h6m-6,0v12m0,-8h6v4h-6",n:"v12m0,-12h6v12m-6,-8h6m0,4h-6",l:"h6m-6,0v12m0,-8h6m-6,4h6",g:"h6v12m0,-4h-6v4",k:"h6m-6,0v12m0,-4h6v4",h:"h6m-6,0v12m0,-4h6",j:"h6v12m0,-8h-6v8m0,-4h6",q:"h6m-6,0v12m0,-8h6v8m-6,-4h6",x:"h6m-6,0v4h6v8m0,-4h-6v4",zh:"v8h6m-6,-4h6m-6,-4h6v12",ch:"v12m0,-12h6v8h-6m0,-4h6",sh:"v4h6m-6,-4h6v8h-6v4",r:"v8h6v4m-6,-12h6v4h-6",z:"h6v8h-6m6,-4h-6v8",c:"h6m-6,0v8h6m-6,-4h6v8",s:"h6m-6,0v4h6v8",v:"h6v12m-6,-8h6",yj:"h6v4h-6v8m0,-4h6v4",nj:"v4h6m-6,-4h6v12m0,-4h-6v4",rz:"h6v4h-6v8",nz:"h6m-6,0v12m0,-8h6v8",ng:"v12m0,-4h6m-6,-8h6v12",ngw:"v12m0,-12h6v8h-6",nw:"v12m0,-12h6v4h-6m0,4h6v4",dw:"v4h6m-6,-4h6v12m0,-4h-6",tw:"v12m0,-12h6v4h-6m0,4h6",gw:"h6v12m0,-8h-6m6,4h-6v4",kw:"v12m0,-12h6m0,4h-6m0,4h6v4","0":"v12","1":"v12m0,-4h6","2":"v12m4,-4v4","3":"v12m0,-4h6m-2,0v4","4":"v12m0,-8h4v4","5":"v12m0,-8h4v4m-4,0h6","6":"v12m0,-8h4v8","7":"v12m0,-8h4v8m-4,-4h6","8":"v12m4,-8h2v8","9":"v12m0,-4h6m-2,-4h2v8",xa:"v12m4,-4v4m0,-8h2v8",xb:"v12m0,-4h6m-2,0v4m0,-8h2v8",xc:"v12m0,-8h6v8m-2,-8v4",xd:"v12m0,-8h6v8m-2,-8v4m-4,0h6",xe:"v12m0,-8h6v8m-2,-8v8",xf:"v12m0,-8h6v8m-6,-4h6m-2,-4v8"},glides:{i:"v2",u:"m0,2h2",y:"v2h2"},vowels:{e:"v6h-2m2,0",a:"v4h-2v2h2",o:"v6h-2v-4h2m0,4",eh:"v6h-2v-6m2,6",oo:"v10h-2v-4h2",ii:"v6h-2v4",uu:"v10h-2"},codas:{i:"v-2",u:"h2",n:"v-2m2,0v2",ng:"h2m-2,-2h2",r:"h2v-2h-2v2"},modifiers:{rr:"m0,8h2v2h-2v-2"},narrowConsonants:{b:"v4h2m0,-4v(12)",p:"v(12)m0,-(8)h2v-4",m:"v(12)m2,-(12)v(12)m-2,-(8)h2",v:"m0,4h2m0,-4v(12)",j:"m2,0v(12)m0,-(8)h-2v(8)m0,-(4)h2",q:"v(12)m0,-(8)h2v(8)m-2,-(4)h2",x:"v4h2v(8)m0,-(4)h-2v(4)",yj:"m2,0v4h-2v(8)m0,-(4)h2v(4)",nj:"v4h2m0,-4v(12)m0,-(4)h-2v(4)",z:"m2,0v8h-2m2,-4h-2v(8)",c:"v8h2m-2,-4h2v(8)",s:"v4h2v(8)",r:"v8h2v(4)m0,-(12)v4h-2",rz:"m2,0v4h-2v(8)",nz:"v(12)m0,-(8)h2v(8)",ng:"v(12)m2,-(12)v(12)m-2,-(4)h2",n:"v(12)m2,-(12)v(12)m-2,-(8)h2m0,4h-2",d:"m2,0v(12)m0,-(8)h-2v4h2",t:"v(12)m0,-(8)h2v4h-2",g:"m2,0v(12)m0,-(4)h-2v(4)",k:"v(12)m0,-(4)h2v(4)",h:"v(12)m0,-(4)h2","":"v(12)m2,-(12)v(12)",ngw:"v(12)m2,-(12)v8h-2",nw:"v(12)m2,-(12)v4h-2m0,4h2v(4)",dw:"v4h2m0,-4v(12)m0,-(4)h-2",tw:"v(12)m2,-(12)v4h-2m0,4v(4)",gw:"m2,0v(12)m0,-(8)h-2m2,4h-2v(4)",kw:"v(12)m2,-(8)h-2m0,4h2v(4)",f:"v(12)m0,-(8)h2"}}});function _(e,n,t,r){if("consonant"in e)return`M${r?n:n-2},0`+Ye[e.consonant].replace(/\((\d+)\)/g,(i,s)=>t?s-2:s);if("modifier"in e)return`M${n-2},0`+se[e.modifier];let o="";return"glide"in e&&(o+=`M${r?n+2:n-2},${e.reversed?12:0}`+P(qe[e.glide],r,e.reversed)),o+=`M${n},${e.reversed?12:0}`,"vowel"in e?(o+=P(Fe[e.vowel],r,e.reversed),"coda"in e?o+=`M${r?n+2:n-2},${e.reversed?2:10}`+P(Ke[e.coda],r,e.reversed):["e","a","o","eh"].includes(e.vowel)&&(o+=`v${(e.reversed?-1:1)*(t?4:6)}`)):o+=`v${(e.reversed?-1:1)*(t?10:12)}`,o}function _e(e){return!(e.reversed&&(e.coda||["oo","ii","uu"].includes(e.vowel)))}function j(e,n){var W;let t="",r=0;e.forEach(V=>{let X=r+4*A(V[0].pre,h=>h.reversed),B=1/0,Z=[];V.forEach((h,be)=>{h.hyphen&&Z.push(r-2);let g=r+4*A(h.pre,_e),$=r+4*A(h.pre,l=>!l.reversed),J=r+4*h.pre.length;if(h.proper&&(t+=`M${r},-2v2`,g>r&&g<=$&&(t+=`H${g}`)),$<J&&((!h.proper||g===r||g<$)&&(t+=`M${$},0`),t+=`H${J}`),h.pre.forEach(l=>{t+=_(l,r,l.reversed?r<g||r>$:r>X,!0),r+=4}),"modifier"in h.main?(t+=`M${r},0`+se[h.main.modifier],r+=2):"consonant"in h.main?(t+=`M${r},0`+Be[h.main.consonant],r+=6):(t+=`M${r},0h2`+_(h.main,r+2,!1,!1),r+=2),be===V.length-1&&(B=r+4*(K(h.post,l=>l.reversed)+1)),h.post.length){let l=r+4*(K(h.post,z=>!z.reversed)+1);l>r&&(t+=`M${r},0H${l}`),h.post.forEach(z=>{r+=4,t+=_(z,r,z.reversed?r<l:r<B,!1)})}r+=2}),t+=`M${X},12`,Z.forEach(h=>{t+=`H${h}v2h2v-2`}),t+=`H${B}`});let o=(W=n==null?void 0:n.strokeWidth)!=null?W:1,i=-.5-o/2,s=-2-o/2,a=r,c=16+o,v=c/16,O=-(2+o/2)/16;return n!=null&&n.raw?{strokeWidth:o,left:i,top:s,width:a,height:c,heightEms:v,verticalAlignEms:O,d:t}:`<svg xmlns="http://www.w3.org/2000/svg" height="${v}em" viewBox="${i},${s},${a},${c}" style="vertical-align:${O}em"><path fill="none" stroke="currentColor" stroke-width="${o}" stroke-linecap="square" d="${t}"/></svg>`}var Be,qe,Fe,Ke,se,Ye,ae=u(()=>{T();oe();({consonants:Be,glides:qe,vowels:Fe,codas:Ke,modifiers:se,narrowConsonants:Ye}=ie)});var I={};Q(I,{NotEncodedError:()=>H,ParseError:()=>b,parseCharacter:()=>ge,parseMixed:()=>Ge,stringifyCharacter:()=>pe,stringifyText:()=>Ue});function me(e){return e===void 0?"EOF":e.toString(16).toUpperCase().padStart(4,"0")}function ue(){if(!he){for(let e=0;e<10;e++)m[57408+e]={consonant:String(e)};for(let e=10;e<16;e++)m[57408+e]={consonant:`x${e.toString(16)}`};",b,p,m,f,d,t,n,l,g,k,h,j,q,x,zh,ch,sh,r,z,c,s,v".split(",").forEach((e,n)=>{m[57424+n]={consonant:e},G[e]=57424+n}),"i,u,y".split(",").forEach((e,n)=>{m[57447+n]={glide:e},C[C[e]=57460+n]=e}),"e,a,o".split(",").forEach((e,n)=>{m[57450+n]={vowel:e},p[p[e]=57463+n]=e}),p[p.eh=57466]="eh",m[57453]={modifier:"rr"},"i,u,n,ng,r".split(",").forEach((e,n)=>{S[S[e]=57467+n]=e});{let e=57488,n=t=>{E[e++]={...t},x[e++]={...t},x[e++]={...t,reversed:!0},E[e++]={...t,reversed:!0}};for(let t of[null,{glide:"i"},{glide:"u"},{glide:"y"}]){n(t);for(let r of"ea")for(let o of[null,{coda:"i"},{coda:"u"},{coda:"n"},{coda:"ng"},{coda:"r"}])n({...t,vowel:r,...o})}n({vowel:"o"}),n({vowel:"o",coda:"ng"}),n({vowel:"eh"})}"yj,nj,rz,nz,ng,ngw,nw,dw,tw,gw,kw".split(",").forEach((e,n)=>{m[57712+n]={consonant:e}}),m[57728]={vowel:"oo"},m[57729]={vowel:"ii"},m[57730]={vowel:"uu"},m[57731]={vowel:"a",coda:"i"},m[57732]={vowel:"a",coda:"u"},m[57733]={vowel:"e",coda:"u"},m[57734]={vowel:"a",coda:"n"},m[57735]={vowel:"a",coda:"ng"},m[57736]={vowel:"e",coda:"n"},m[57737]={vowel:"e",coda:"ng"},m[57738]={vowel:"e",coda:"i"},m[57739]={};{let e=57744,n=t=>{E[e++]={...t},x[e++]={...t}};"b,p,m,v,j,q,x,yj,nj,z,c,s,rz,nz,ng,n,d,t,g,k,h,,ngw,nw,dw,tw,gw,kw,f".split(",").forEach(t=>n({consonant:t})),e=57808,n({vowel:"oo"}),n({vowel:"ii"}),n({vowel:"uu"}),e=57816,n({glide:"i",vowel:"oo"}),n({glide:"i",vowel:"uu"}),n({glide:"u",vowel:"oo"}),n({glide:"u",vowel:"ii"})}he=!0}}function U(e,n){let t=Y(e,r=>w(r,n));if(t===void 0)throw new H("Cannot stringify element "+JSON.stringify(n));return d(+t)}function pe(e,n){ue();let t="";e.hyphen&&(t+=d(ce)),e.proper&&(t+=d(ve));e:if(n!=null&&n.mandarin){if(e.pre.length+e.post.length!==1)break e;let r=t;if(!("consonant"in e.main)||!f(G,e.main.consonant))break e;r+=d(G[e.main.consonant]);let o=!!e.pre.length,i=o?e.pre[0]:e.post[0];if(!o&&e.main.consonant==="h"){if(w(i,{consonant:"m"}))return r+d(fe);if(w(i,{consonant:""}))return r+d(de)}if("consonant"in i||"modifier"in i)break e;let s=i.reversed?o?"3":"4":o?"2":"1";if(r+=d(le[s]),"glide"in i&&(r+=d(C[i.glide])),"vowel"in i){if(!f(p,i.vowel))break e;r+=d(p[i.vowel])}return"coda"in i&&(r+=d(S[i.coda])),r}for(let r of e.pre)t+=U(x,r);t+=U(m,e.main);for(let r of e.post)t+=U(E,r);return t}function Ue(e,n){return e.map(t=>t.map(r=>pe(r,n)).join("")).join(" ")}function ge(e){ue();let n=[...e].map(c=>c.codePointAt(0)),t=0,r={},o=[],i,s=[],a=c=>({source:String.fromCodePoint(...n.slice(0,t)),character:{...r,pre:o,main:i,post:s,...c}});if(n[t]===ce&&(t++,r.hyphen=!0),n[t]===57453)return t++,a({main:{modifier:"rr"}});for(n[t]===ve&&(t++,r.proper=!0);f(x,n[t]);)o.push(x[n[t++]]);if(!f(m,n[t]))throw new b(`Unexpected ${me(n[t])}, expected ${o.length?"consonant ":""}letter`);if(i=m[n[t]],o.length&&(!("consonant"in i)||/^\d$|^x[a-f]$/.test(i.consonant)))throw new b(`Unexpected ${me(n[t])}, expected consonant letter`);t++;e:if(!o.length){if(n[t]===fe)return t++,a({post:[{consonant:"m"}]});if(n[t]===de)return t++,a({post:[{consonant:"w"}]});let c=Y(le,O=>O===n[t]);if(!c)break e;t++;let v={};(c==="3"||c==="4")&&(v.reversed=!0),f(C,n[t])&&(v.glide=C[n[t++]]);n:if(f(p,n[t])){if("glide"in v&&!["e","a"].includes(p[n[t]]))break n;v.vowel=p[n[t++]],f(S,n[t])&&(v.coda=S[n[t++]])}return a(c==="2"||c==="3"?{pre:[v]}:{post:[v]})}for(;f(E,n[t]);)s.push(E[n[t++]]);return a()}function Ge(e){let n=[];for(;e.length;){let t=[];for(;e.length;){let r=e.codePointAt(0);if(r<57408||r>57823)break;let o;try{o=ge(e)}catch(a){if(a instanceof b)break;throw a}let{source:i,character:s}=o;t.push(s),e=e.slice(i.length)}if(t.length)n[n.length-1]===" "&&n.pop(),n.push(t);else{let r=String.fromCodePoint(e.codePointAt(0));typeof n[n.length-1]=="string"?n[n.length-1]+=r:n.push(r),e=e.slice(r.length)}}return n}var d,he,m,G,ce,ve,le,C,p,S,fe,de,x,E,H,b,we=u(()=>{T();d=String.fromCodePoint;he=!1,m={},G={},ce=57454,ve=57455,le={1:57456,2:57457,3:57458,4:57459},C={},p={},S={},fe=57472,de=57473,x={},E={};H=class extends Error{constructor(){super(...arguments);this.name="lnnzhyz2svg.PUA.NotEncodedError"}};b=class extends Error{constructor(){super(...arguments);this.name="lnnzhyz2svg.PUA.ParseError"}}});var xe={};Q(xe,{PUA:()=>I,compileMandarin:()=>k,compileShidinn:()=>M,draw:()=>j,drawMandarin:()=>We,drawShidinn:()=>Xe,elementEquals:()=>w});function We(e,n){return j(k(e),n)}function Xe(e,n){return j(M(e),n)}var Ee=u(()=>{re();ae();we();T()});var{drawMandarin:Ze,drawShidinn:Je}=(Ee(),Ce(xe)),N=class{constructor(n,t,r){this.inputbox=n,this.out=t,this.fn=r,this.inputbox.oninput=()=>{this.error=null;try{this.update()}catch(o){this.error=o}},this.inputbox.onblur=()=>{this.error&&(t.innerText=this.error)};try{this.update()}catch(o){t.innerText=o,console.error(o)}}update(){let n=this.inputbox.value||this.inputbox.placeholder;n=n.replace(/\ufdd0/g,"\uFFFD").replace(/</g,"\uFDD0"),n=n.replace(/[\^]?\w+(?:[ _\-][\^]?\w+)*/g,this.fn),n=n.replace(/\ufdd0/g,"&lt;").replace(/\n/g,"<br>"),this.out.innerHTML=n}};new N(document.getElementById("inputbox-mandarin"),document.getElementById("out-mandarin"),e=>Ze(e));new N(document.getElementById("inputbox-shidinn"),document.getElementById("out-shidinn"),e=>Je(e));})();
